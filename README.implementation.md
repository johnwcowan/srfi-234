Implementation taken and adapted from gauche scheme https://github.com/shirok/Gauche/blob/master/lib/util/toposort.scm
